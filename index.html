<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KCC GLASS | ìŠ¤ë§ˆíŠ¸ ì‹¤ì¸¡ ì ‘ìˆ˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css" />
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #f3f4f6; color: #1f2937; }
        .input-label { display: block; font-size: 0.875rem; font-weight: 600; color: #374151; margin-bottom: 0.35rem; }
        .input-field { 
            width: 100%; padding: 0.75rem; 
            border: 1px solid #d1d5db; border-radius: 0.5rem; 
            font-size: 1rem; background-color: #ffffff; transition: all 0.2s;
        }
        .input-field:focus { outline: none; border-color: #1e3a8a; ring: 2px; ring-color: #1e3a8a; }
        .input-readonly { background-color: #f9fafb; cursor: pointer; }
        
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        button, input, select { touch-action: manipulation; }
        @keyframes fadeInUp { from { opacity: 0; transform: translate3d(0, 20px, 0); } to { opacity: 1; transform: translate3d(0, 0, 0); } }
        .animate-fade-in-up { animation: fadeInUp 0.4s ease-out; }
    </style>
</head>
<body class="pb-24">

    <header class="bg-blue-900 text-white p-4 sticky top-0 z-50 shadow-md">
        <div class="max-w-md mx-auto flex justify-between items-center">
            <h1 class="text-lg font-bold tracking-tight">KCC GLASS | ì‹¤ì¸¡ ì ‘ìˆ˜</h1>
            <span class="text-xs bg-white text-blue-900 px-2 py-1 rounded font-bold">ê³ ê°ìš©</span>
        </div>
    </header>

    <div class="max-w-md mx-auto p-4 space-y-5">

        <section class="bg-white p-5 rounded-xl shadow-sm border-l-4 border-blue-600">
            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                <span class="bg-blue-100 text-blue-700 rounded-full w-8 h-8 flex items-center justify-center mr-2 text-sm">1</span> ê³ ê° ì •ë³´
            </h2>
            <div class="space-y-3">
                <div>
                    <label class="input-label">ê³ ê° ì„±í•¨</label>
                    <input type="text" id="customerName" class="input-field bg-gray-50" placeholder="ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
                </div>
                <div>
                    <label class="input-label">ì—°ë½ì²˜ (ìˆ«ìë§Œ ì…ë ¥)</label>
                    <input type="tel" id="customerPhone" class="input-field bg-gray-50" placeholder="01012345678" maxlength="11" inputmode="numeric">
                </div>
            </div>
        </section>

        <section class="bg-white p-5 rounded-xl shadow-sm border-l-4 border-blue-600">
            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                <span class="bg-blue-100 text-blue-700 rounded-full w-8 h-8 flex items-center justify-center mr-2 text-sm">2</span> í˜„ì¥ ì •ë³´
            </h2>
            
            <div class="space-y-4">
                <div>
                    <label class="input-label">í˜„ì¥ ì£¼ì†Œ</label>
                    <div class="flex gap-2 mb-2">
                        <input type="text" id="postcode" class="input-field w-1/3 text-center input-readonly" placeholder="ìš°í¸ë²ˆí˜¸" readonly onclick="openPostcode()">
                        <button onclick="openPostcode()" class="bg-blue-600 text-white px-4 rounded-lg text-sm font-bold hover:bg-blue-700 transition w-2/3">
                            ğŸ” ì£¼ì†Œ ê²€ìƒ‰
                        </button>
                    </div>
                    <input type="text" id="roadAddress" class="input-field mb-2 input-readonly" placeholder="ë„ë¡œëª…/ì§€ë²ˆ ì£¼ì†Œ (ìë™ì…ë ¥)" readonly onclick="openPostcode()">
                    <input type="text" id="detailAddress" class="input-field" placeholder="ìƒì„¸ì£¼ì†Œ ì…ë ¥ (ì˜ˆ: 101ë™ 102í˜¸)">
                </div>

                <div>
                    <label class="input-label">ë² ë€ë‹¤ í™•ì¥ ì—¬ë¶€</label>
                    <div class="flex gap-2">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="extension" value="í™•ì¥" class="peer hidden" checked>
                            <div class="p-3 text-center border rounded-lg peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-600 text-gray-500 font-medium transition">í™•ì¥ë¨</div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="extension" value="ë¹„í™•ì¥" class="peer hidden">
                            <div class="p-3 text-center border rounded-lg peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-600 text-gray-500 font-medium transition">í™•ì¥ ì•ˆ í•¨</div>
                        </label>
                    </div>
                </div>

                <div>
                    <label class="input-label">íŠ¹ì´ì‚¬í•­ (ë©”ëª¨)</label>
                    <textarea id="memo" class="input-field h-24 resize-none" placeholder="ì˜ˆ: ì‚¬ë‹¤ë¦¬ì°¨ ë¶ˆê°€, ê±°ì£¼ì¤‘ ì‹œê³µ ë“±"></textarea>
                </div>
            </div>
        </section>

        <section>
            <div class="flex justify-between items-end mb-3 px-1">
                <h2 class="text-lg font-bold text-gray-800 flex items-center">
                    <span class="bg-blue-100 text-blue-700 rounded-full w-8 h-8 flex items-center justify-center mr-2 text-sm">3</span> ì‹œê³µ ìœ„ì¹˜ ë° ì‚¬ì´ì¦ˆ
                </h2>
            </div>
            <div id="windowList" class="space-y-4"></div>
            <button onclick="addWindowArea()" class="w-full mt-4 py-3 border-2 border-dashed border-blue-300 text-blue-600 rounded-xl font-bold hover:bg-blue-50 transition flex justify-center items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                ì°½í˜¸ ì¶”ê°€í•˜ê¸°
            </button>
        </section>

        <div class="pt-6">
            <button onclick="submitData()" class="w-full bg-blue-900 text-white py-4 rounded-xl text-lg font-bold shadow-lg active:scale-95 transition transform flex justify-center items-center gap-2">
                <span>ê²¬ì  ìš”ì²­í•˜ê¸°</span>
            </button>
            <p class="text-center text-xs text-gray-400 mt-3">ì œì¶œí•˜ì‹œë©´ ë‹´ë‹¹ìê°€ í™•ì¸ í›„ ì—°ë½ë“œë¦½ë‹ˆë‹¤.</p>
        </div>
    </div>

    <div id="loading" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 flex flex-col justify-center items-center text-white backdrop-blur-sm">
        <div class="animate-spin rounded-full h-12 w-12 border-4 border-gray-300 border-t-blue-500 mb-4"></div>
        <p class="font-bold text-lg">ë°ì´í„° ì „ì†¡ ì¤‘...</p>
    </div>

    <script>
        // â˜… ë°°í¬ëœ Apps Script URL ì…ë ¥ (execë¡œ ëë‚˜ëŠ” ì£¼ì†Œ) â˜…
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycby68x8slMzZ5tbmtwbBqKCvjTUaPxGzWy_21rYpP74Ty86gHHadqZVnAyu1w-JhnwC-Mg/exec"; 

        const locationOptions = [
            "ê±°ì‹¤ ë² ë€ë‹¤(ì™¸ì°½)", "ê±°ì‹¤ ë¶„í•©ë¬¸", "ì•ˆë°© ë² ë€ë‹¤(ì™¸ì°½)", "ì•ˆë°© ë‚´ì°½(ë‹¨ì°½)", "ì•ˆë°© ë‚´ì°½(ì´ì¤‘ì°½)",
            "ì‘ì€ë°©1(ì™¸ì°½)", "ì‘ì€ë°©1(ë‚´ì°½)", "ì‘ì€ë°©2(ì™¸ì°½)", "ì‘ì€ë°©2(ë‚´ì°½)",
            "ì£¼ë°© ë² ë€ë‹¤(ì™¸ì°½)", "ì£¼ë°© ë² ë€ë‹¤(ë‚´ì°½)", "ì£¼ë°© í„°ë‹ë„ì–´", "ê±°ì‹¤ í„°ë‹ë„ì–´", "ê¸°íƒ€(ì§ì ‘ì…ë ¥)"
        ];

        window.onload = function() { addWindowArea(); };

        // [ê¸°ëŠ¥ 1] ì—°ë½ì²˜ ìˆ«ìë§Œ ì…ë ¥ë˜ê²Œ ì œí•œ
        document.getElementById('customerPhone').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '');
        });

        // [ê¸°ëŠ¥ 2] ì¹´ì¹´ì˜¤ ì£¼ì†Œ ê²€ìƒ‰ ì—°ë™
        function openPostcode() {
            new daum.Postcode({
                oncomplete: function(data) {
                    let addr = data.userSelectedType === 'R' ? data.roadAddress : data.jibunAddress;
                    if(data.buildingName !== '' && data.userSelectedType === 'R') {
                         addr += ' (' + data.buildingName + ')';
                    }
                    document.getElementById('postcode').value = data.zonecode;
                    document.getElementById('roadAddress').value = addr;
                    document.getElementById('detailAddress').focus();
                }
            }).open();
        }

        function addWindowArea() {
            const container = document.getElementById('windowList');
            const id = Date.now();
            const optionsHtml = locationOptions.map(opt => `<option value="${opt}">${opt}</option>`).join('');

            const html = `
                <div class="window-card bg-white p-5 rounded-xl shadow-sm relative animate-fade-in-up transition-all border border-gray-100" id="card-${id}">
                    <button onclick="removeWindowArea('${id}')" class="absolute top-3 right-3 text-gray-400 hover:text-red-500 p-2"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>
                    <div class="mb-4">
                        <label class="input-label text-blue-800">ğŸ“ ìœ„ì¹˜ ì„ íƒ</label>
                        <select class="input-field bg-white loc-select" onchange="toggleEtcInput('${id}', this.value)">${optionsHtml}</select>
                        <input type="text" id="etc-${id}" class="input-field mt-2 hidden" placeholder="ì˜ˆ: ë‹¤ìš©ë„ì‹¤ í”½ìŠ¤ì°½">
                    </div>
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <div><label class="input-label">ê°€ë¡œ (mm)</label><input type="number" pattern="\\d*" inputmode="numeric" class="input-field width-input" placeholder="0"></div>
                        <div><label class="input-label">ì„¸ë¡œ (mm)</label><input type="number" pattern="\\d*" inputmode="numeric" class="input-field height-input" placeholder="0"></div>
                    </div>
                    <div>
                        <label class="input-label flex justify-between items-center"><span>ğŸ“¸ í˜„ì¥ ì‚¬ì§„</span><span class="text-xs text-blue-600 bg-blue-50 px-2 py-0.5 rounded">ì„ íƒì‚¬í•­</span></label>
                        <input type="file" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2.5 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 photo-input mt-1 border border-gray-200 rounded-lg cursor-pointer"/>
                    </div>
                </div>`;
            container.insertAdjacentHTML('beforeend', html);
        }

        function toggleEtcInput(id, value) {
            const etcInput = document.getElementById(`etc-${id}`);
            if (value === "ê¸°íƒ€(ì§ì ‘ì…ë ¥)") { etcInput.classList.remove('hidden'); etcInput.focus(); }
            else { etcInput.classList.add('hidden'); etcInput.value = ""; }
        }

        function removeWindowArea(id) {
            const card = document.getElementById(`card-${id}`);
            if(document.querySelectorAll('.window-card').length === 1) return alert("ìµœì†Œ 1ê°œì˜ ì •ë³´ëŠ” í•„ìš”í•©ë‹ˆë‹¤.");
            if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) card.remove();
        }

        const fileToBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });

        async function submitData() {
            const name = document.getElementById('customerName').value;
            const phone = document.getElementById('customerPhone').value;
            
            // ì£¼ì†Œ ì¡°í•©
            const roadAddr = document.getElementById('roadAddress').value;
            const detailAddr = document.getElementById('detailAddress').value;
            const fullAddress = roadAddr ? `${roadAddr} ${detailAddr}` : "";

            if(!name) return alert("ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            if(!phone || phone.length < 9) return alert("ì˜¬ë°”ë¥¸ ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            if(!fullAddress) return alert("ì£¼ì†Œë¥¼ ê²€ìƒ‰í•˜ì—¬ ì…ë ¥í•´ì£¼ì„¸ìš”.");

            if(APPS_SCRIPT_URL.includes("ì—¬ê¸°ì—_URL")) return alert("ì„œë²„ ì£¼ì†Œ(URL) ì„¤ì • ì˜¤ë¥˜");

            document.getElementById('loading').classList.remove('hidden');

            const extension = document.querySelector('input[name="extension"]:checked').value;
            const memo = document.getElementById('memo').value;
            
            const windowCards = document.querySelectorAll('.window-card');
            const windowsData = [];
            let isLocationValid = true;

            for (const card of windowCards) {
                const selectVal = card.querySelector('.loc-select').value;
                let finalLocation = selectVal === "ê¸°íƒ€(ì§ì ‘ì…ë ¥)" ? card.querySelector(`input[id^="etc-"]`).value : selectVal;
                
                if(!finalLocation) { alert("ìœ„ì¹˜ ëª…ì¹­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); isLocationValid = false; break; }

                const fileInput = card.querySelector('.photo-input');
                let photoData = null, photoName = null, photoMimeType = null;

                if (fileInput.files.length > 0) {
                    try {
                        const file = fileInput.files[0];
                        if(file.size > 10 * 1024 * 1024) { alert("ì‚¬ì§„ì€ 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤."); document.getElementById('loading').classList.add('hidden'); return; }
                        photoData = await fileToBase64(file);
                        photoName = file.name;
                        photoMimeType = file.type;
                    } catch (e) {}
                }

                windowsData.push({
                    location: finalLocation,
                    width: card.querySelector('.width-input').value,
                    height: card.querySelector('.height-input').value,
                    photoData: photoData, photoName: photoName, photoMimeType: photoMimeType
                });
            }

            if(!isLocationValid) { document.getElementById('loading').classList.add('hidden'); return; }

            const payload = {
                customerName: name,
                customerPhone: phone,
                address: fullAddress,
                extension: extension,
                memo: memo,
                windows: windowsData
            };

            // â˜… ìš”ì²­í•˜ì‹  CORS í•´ê²°ìš© Fetch ì½”ë“œ ì ìš©ë¨ â˜…
            fetch(APPS_SCRIPT_URL, {
                method: "POST",
                redirect: "follow",
                headers: {
                    "Content-Type": "text/plain;charset=utf-8", 
                },
                body: JSON.stringify(payload)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('loading').classList.add('hidden');
                if(data.result === 'success') {
                    alert("âœ… ê²¬ì  ìš”ì²­ ì™„ë£Œ!\në¹ ë¥¸ ì‹œì¼ ë‚´ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.");
                    window.location.reload();
                } else {
                    alert("ì˜¤ë¥˜ ë°œìƒ: " + (data.error || "ì•Œ ìˆ˜ ì—†ìŒ"));
                }
            })
            .catch(error => {
                document.getElementById('loading').classList.add('hidden');
                console.error(error);
                alert("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë°œìƒ. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            });
        }
    </script>
</body>

</html>


