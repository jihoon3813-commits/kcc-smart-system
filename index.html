<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KCC GLASS | ì‹¤ì¸¡ ì ‘ìˆ˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css" />
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #f3f4f6; color: #1f2937; }
        
        /* ì…ë ¥ í•„ë“œ ë””ìì¸ (ì›ë˜ ìŠ¤íƒ€ì¼) */
        .input-label { display: block; font-size: 0.875rem; font-weight: 600; color: #374151; margin-bottom: 0.35rem; }
        .input-field { 
            width: 100%; padding: 0.8rem; 
            border: 1px solid #d1d5db; border-radius: 0.75rem; 
            font-size: 1rem; background-color: #ffffff;
            transition: all 0.2s;
        }
        .input-field:focus { outline: none; border-color: #1e3a8a; ring: 2px; ring-color: #1e3a8a; }
        
        /* ìˆ«ì ì…ë ¥ í™”ì‚´í‘œ ì œê±° */
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes fadeInUp { from { opacity: 0; transform: translate3d(0, 15px, 0); } to { opacity: 1; transform: translate3d(0, 0, 0); } }
        .animate-fade-in-up { animation: fadeInUp 0.4s ease-out; }
    </style>
</head>
<body class="pb-24">

    <header class="bg-blue-900 text-white p-5 sticky top-0 z-50 shadow-lg">
        <div class="max-w-md mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold tracking-tight">KCC GLASS</h1>
            <span class="text-xs bg-white text-blue-900 px-2 py-1 rounded-full font-bold">ê°„í¸ì ‘ìˆ˜</span>
        </div>
    </header>

    <div class="max-w-md mx-auto p-5 space-y-6">

        <section class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                <span class="bg-blue-100 text-blue-700 rounded-full w-8 h-8 flex items-center justify-center mr-2 text-sm">1</span> ê³ ê° ì •ë³´
            </h2>
            <div class="space-y-4">
                <div>
                    <label class="input-label">ê³ ê° ì„±í•¨</label>
                    <input type="text" id="customerName" class="input-field bg-gray-50" placeholder="ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
                </div>
                <div>
                    <label class="input-label">ì—°ë½ì²˜ (ìˆ«ìë§Œ ì…ë ¥)</label>
                    <input type="tel" id="customerPhone" class="input-field bg-gray-50" placeholder="01012345678" maxlength="11" inputmode="numeric">
                </div>
            </div>
        </section>

        <section class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                <span class="bg-blue-100 text-blue-700 rounded-full w-8 h-8 flex items-center justify-center mr-2 text-sm">2</span> í˜„ì¥ ì •ë³´
            </h2>
            
            <div class="space-y-4">
                <div>
                    <label class="input-label">í˜„ì¥ ì£¼ì†Œ</label>
                    <div class="flex gap-2 mb-2">
                        <input type="text" id="postcode" class="input-field w-1/3 text-center bg-gray-100" placeholder="ìš°í¸ë²ˆí˜¸" readonly onclick="openPostcode()">
                        <button onclick="openPostcode()" class="bg-blue-600 text-white px-4 rounded-xl text-sm font-bold hover:bg-blue-700 transition w-2/3 shadow-md">
                            ğŸ” ì£¼ì†Œ ê²€ìƒ‰
                        </button>
                    </div>
                    <input type="text" id="roadAddress" class="input-field mb-2 bg-gray-100" placeholder="ì£¼ì†Œ (ìë™ ì…ë ¥)" readonly onclick="openPostcode()">
                    <input type="text" id="detailAddress" class="input-field" placeholder="ìƒì„¸ì£¼ì†Œ (ì˜ˆ: 101ë™ 102í˜¸)">
                </div>

                <div>
                    <label class="input-label">ë² ë€ë‹¤ í™•ì¥ ì—¬ë¶€</label>
                    <div class="flex gap-2">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="extension" value="í™•ì¥" class="peer hidden" checked>
                            <div class="p-3 text-center border-2 border-gray-200 rounded-xl peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700 font-bold transition">í™•ì¥ë¨</div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="extension" value="ë¹„í™•ì¥" class="peer hidden">
                            <div class="p-3 text-center border-2 border-gray-200 rounded-xl peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700 font-bold transition">í™•ì¥ ì•ˆ í•¨</div>
                        </label>
                    </div>
                </div>

                <div>
                    <label class="input-label">íŠ¹ì´ì‚¬í•­ (ë©”ëª¨)</label>
                    <textarea id="memo" class="input-field h-24 resize-none" placeholder="ì˜ˆ: ì‚¬ë‹¤ë¦¬ì°¨ ë¶ˆê°€, ê±°ì£¼ì¤‘ ì‹œê³µ ë“±"></textarea>
                </div>
            </div>
        </section>

        <section>
            <div class="flex justify-between items-end mb-3 px-2">
                <h2 class="text-lg font-bold text-gray-800 flex items-center">
                    <span class="bg-blue-100 text-blue-700 rounded-full w-8 h-8 flex items-center justify-center mr-2 text-sm">3</span> ì‹œê³µ ìœ„ì¹˜
                </h2>
            </div>
            
            <div id="windowList" class="space-y-4"></div>

            <button onclick="addWindowArea()" class="w-full mt-5 py-4 border-2 border-dashed border-blue-300 text-blue-600 rounded-2xl font-bold hover:bg-blue-50 transition flex justify-center items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                ì°½í˜¸ ì¶”ê°€í•˜ê¸°
            </button>
        </section>

        <div class="pt-6">
            <button onclick="submitData()" class="w-full bg-gradient-to-r from-blue-900 to-blue-800 text-white py-4 rounded-2xl text-lg font-bold shadow-xl active:scale-95 transition transform flex justify-center items-center gap-2">
                <span>ê²¬ì  ìš”ì²­í•˜ê¸°</span>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"></path></svg>
            </button>
            <p class="text-center text-xs text-gray-400 mt-3">ì œì¶œ ì‹œ ê°œì¸ì •ë³´ ìˆ˜ì§‘ì— ë™ì˜í•˜ëŠ” ê²ƒìœ¼ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤.</p>
        </div>

    </div>

    <div id="loading" class="hidden fixed inset-0 bg-black/60 z-50 flex flex-col justify-center items-center text-white backdrop-blur-sm">
        <div class="animate-spin rounded-full h-12 w-12 border-4 border-white/30 border-t-white mb-4"></div>
        <p class="font-bold text-lg">ë°ì´í„° ì „ì†¡ ì¤‘...</p>
    </div>

    <script>
        // â˜…â˜…â˜… ë°°í¬ëœ Apps Script URLì„ ì—¬ê¸°ì— ë„£ìœ¼ì„¸ìš” â˜…â˜…â˜…
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwjmu1V8U7qdtGq-o6Qed23SdNAUvGQ8udLKo5BOmgz1DLu7uOHGHUv7K_-3MvtEpKR/exec"; 

        const locationOptions = ["ê±°ì‹¤ ë² ë€ë‹¤(ì™¸ì°½)", "ê±°ì‹¤ ë¶„í•©ë¬¸", "ì•ˆë°© ë² ë€ë‹¤(ì™¸ì°½)", "ì•ˆë°© ë‚´ì°½(ë‹¨ì°½)", "ì•ˆë°© ë‚´ì°½(ì´ì¤‘ì°½)", "ì‘ì€ë°©1(ì™¸ì°½)", "ì‘ì€ë°©1(ë‚´ì°½)", "ì‘ì€ë°©2(ì™¸ì°½)", "ì‘ì€ë°©2(ë‚´ì°½)", "ì£¼ë°© ë² ë€ë‹¤(ì™¸ì°½)", "ì£¼ë°© ë² ë€ë‹¤(ë‚´ì°½)", "ì£¼ë°© í„°ë‹ë„ì–´", "ê±°ì‹¤ í„°ë‹ë„ì–´", "ê¸°íƒ€(ì§ì ‘ì…ë ¥)"];

        window.onload = function() { addWindowArea(); };

        // [ê¸°ëŠ¥] ìˆ«ìë§Œ ì…ë ¥ë˜ë„ë¡ ê°•ì œ
        document.getElementById('customerPhone').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '');
        });

        // [ê¸°ëŠ¥] ì¹´ì¹´ì˜¤ ì£¼ì†Œ ê²€ìƒ‰
        function openPostcode() {
            new daum.Postcode({
                oncomplete: function(data) {
                    let addr = data.userSelectedType === 'R' ? data.roadAddress : data.jibunAddress;
                    if(data.buildingName !== '' && data.userSelectedType === 'R') addr += ' (' + data.buildingName + ')';
                    document.getElementById('postcode').value = data.zonecode;
                    document.getElementById('roadAddress').value = addr;
                    document.getElementById('detailAddress').focus();
                }
            }).open();
        }

        function addWindowArea() {
            const container = document.getElementById('windowList');
            const id = Date.now();
            const optionsHtml = locationOptions.map(opt => `<option value="${opt}">${opt}</option>`).join('');

            const html = `
                <div class="window-card bg-white p-5 rounded-2xl shadow-sm relative animate-fade-in-up border border-gray-100" id="card-${id}">
                    <button onclick="removeWindowArea('${id}')" class="absolute top-3 right-3 text-gray-300 hover:text-red-500 p-2 transition"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                    <div class="mb-4">
                        <label class="input-label text-blue-800">ğŸ“ ìœ„ì¹˜ ì„ íƒ</label>
                        <select class="input-field bg-white loc-select" onchange="toggleEtcInput('${id}', this.value)">${optionsHtml}</select>
                        <input type="text" id="etc-${id}" class="input-field mt-2 hidden" placeholder="ìœ„ì¹˜ ì§ì ‘ ì…ë ¥">
                    </div>
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <div><label class="input-label">ê°€ë¡œ (mm)</label><input type="number" pattern="\\d*" inputmode="numeric" class="input-field width-input" placeholder="0"></div>
                        <div><label class="input-label">ì„¸ë¡œ (mm)</label><input type="number" pattern="\\d*" inputmode="numeric" class="input-field height-input" placeholder="0"></div>
                    </div>
                    <div>
                        <label class="input-label flex justify-between items-center"><span>ğŸ“¸ í˜„ì¥ ì‚¬ì§„</span><span class="text-xs text-blue-600 bg-blue-50 px-2 py-0.5 rounded">ì„ íƒì‚¬í•­</span></label>
                        <input type="file" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2.5 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 photo-input mt-1 border border-gray-200 rounded-lg cursor-pointer"/>
                    </div>
                </div>`;
            container.insertAdjacentHTML('beforeend', html);
        }

        function toggleEtcInput(id, value) {
            const etcInput = document.getElementById(`etc-${id}`);
            if (value === "ê¸°íƒ€(ì§ì ‘ì…ë ¥)") { etcInput.classList.remove('hidden'); etcInput.focus(); }
            else { etcInput.classList.add('hidden'); etcInput.value = ""; }
        }

        function removeWindowArea(id) {
            const card = document.getElementById(`card-${id}`);
            if(document.querySelectorAll('.window-card').length === 1) return alert("ìµœì†Œ 1ê°œì˜ ì •ë³´ëŠ” í•„ìš”í•©ë‹ˆë‹¤.");
            if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) card.remove();
        }

        async function submitData() {
            const name = document.getElementById('customerName').value;
            const phone = document.getElementById('customerPhone').value;
            const addr = document.getElementById('roadAddress').value + " " + document.getElementById('detailAddress').value;

            if(!name) return alert("ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            if(!phone || phone.length < 9) return alert("ì˜¬ë°”ë¥¸ ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            if(document.getElementById('roadAddress').value === "") return alert("ì£¼ì†Œë¥¼ ê²€ìƒ‰í•´ì£¼ì„¸ìš”.");

            if(APPS_SCRIPT_URL.includes("ì—¬ê¸°ì—")) return alert("ì„œë²„ URLì„ ì„¤ì •í•´ì£¼ì„¸ìš”.");

            document.getElementById('loading').classList.remove('hidden');

            const windowCards = document.querySelectorAll('.window-card');
            const windowsData = [];
            
            for (const card of windowCards) {
                let loc = card.querySelector('.loc-select').value;
                if(loc.includes("ê¸°íƒ€")) loc = card.querySelector(`input[id^="etc"]`).value;
                if(!loc) { alert("ìœ„ì¹˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); document.getElementById('loading').classList.add('hidden'); return; }

                const file = card.querySelector('.photo-input').files[0];
                let pData = null, pName = null, pType = null;
                if(file) {
                    pData = await new Promise(r => {const rd=new FileReader(); rd.onload=()=>r(rd.result); rd.readAsDataURL(file);});
                    pName = file.name; pType = file.type;
                }
                windowsData.push({
                    location: loc, width: card.querySelector('.width-input').value, height: card.querySelector('.height-input').value,
                    photoData: pData, photoName: pName, photoMimeType: pType
                });
            }

            const payload = {
                customerName: name, customerPhone: phone, address: addr,
                extension: document.querySelector('input[name="extension"]:checked').value,
                memo: document.getElementById('memo').value,
                windows: windowsData
            };

            fetch(APPS_SCRIPT_URL, {
                method: "POST",
                redirect: "follow",
                headers: { "Content-Type": "text/plain;charset=utf-8" },
                body: JSON.stringify(payload)
            })
            .then(res => res.json())
            .then(data => {
                document.getElementById('loading').classList.add('hidden');
                if(data.result === 'success') { alert("ì ‘ìˆ˜ ì™„ë£Œ!"); location.reload(); }
                else alert("ì˜¤ë¥˜: " + data.error);
            })
            .catch(err => {
                document.getElementById('loading').classList.add('hidden');
                alert("ì „ì†¡ ì‹¤íŒ¨. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.");
            });
        }
    </script>
</body>
</html>